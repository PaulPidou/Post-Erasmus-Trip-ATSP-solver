<!DOCTYPE html>
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" >
 
	<title>test</title>
	
	<style>
		pre {outline: 1px solid #ccc; padding: 5px; margin: 5px; }
		.string { color: green; }
		.number { color: darkorange; }
		.boolean { color: blue; }
		.null { color: magenta; }
		.key { color: red; }
	</style>
	
	<script id="webworker">
		self.onmessage = function(e) {
		  var res = eval(e.data.cmd)(e.data.args);
		  postMessage(res);
		};
	    function run(){
	    	var i = 0;
	    	setInterval(function() {
	       		i++;
	        	postMessage(i); // sent data to main app
	    	}, 500);
	    };
	    var permArr = [], usedChars = [];
	    var len;
	    function permute(input,r) {
	    	if( typeof r === 'undefined' ){
	    		len = input.length;
	    		var i, ch;
	    	}
	        
	        for (i = 0; i < input.length; i++) {
	            ch = input.splice(i, 1)[0];
	            len--;
	            usedChars.push(ch);
	            if (input.length == 0) {
	                permArr.push(usedChars.slice());
	            }
	            permute(input,true);
	            input.splice(i, 0, ch);
	            len++;
	            usedChars.pop();
	        }
	        return permArr;
	    };
	    
	    function permuteExample(){
	    	var arr = [];
	    	for(var i = 0 ; i < 6 ; i++ ){
	    		arr.push(i); //[i,i+1]
	    	};
	    	var permutations = permute(arr);
	    	return permutations;
	    	
	    }; 
	    
	    
	    function confirm(){
	    	postMessage('confirm');
	    }
	    
	</script>
	
	<script id="webworker_roundtrip">
		self.onmessage = function(e) {
		  postMessage({state:'ok'});
		};
	</script>
	
	
	<script>
	
		//changed new Date().getTime() to 
	
		function local(){
		
			var start = window.performance.now();
		
			var data = permuteExample();
			console.log(data);
		
			var end = window.performance.now();
			var time = end - start;
			document.getElementById('ts_normal').innerHTML='Execution time: ' + time + ' ms';
		}
	
		function runWebworker(){
		
		    var URL = window.URL || (window.webkitURL);
		
		    window.URL = URL;
		
		    var workerData = new Blob([document.getElementById('webworker').textContent], {
		        type: "text/javascript"
		    });
		    
		    var start = window.performance.now();
		    
		    worker = new Worker(window.URL.createObjectURL(workerData));
		    worker.postMessage({ 'cmd': 'permuteExample' });
		    worker.onmessage = function (e) {
		    	console.log(e.data);
		    	var end = window.performance.now();
		    	var time = end - start;
		    	document.getElementById('ts_webworker').innerHTML='Execution time: ' + time + ' ms';
		    };
		   	
		};
		
		function runWebworkerFromFile(){
		
		    var start = window.performance.now();
		    
		    worker = new Worker('webworker.js');
		    worker.postMessage({ 'cmd': 'permuteExample' });
		    worker.onmessage = function (e) {
		    	console.log(e.data);
		    	var end = window.performance.now();
		    	var time = end - start;
		    	document.getElementById('ts_webworker_file').innerHTML='Execution time: ' + time + ' ms';
		    };
		   	
		};
		
		
		
		
		function createWebworker(){
			var start = window.performance.now();
			var workerData = new Blob([document.getElementById('webworker_roundtrip').textContent], {
			    type: "text/javascript"
			});
			var worker = new Worker(window.URL.createObjectURL(workerData));
			worker.postMessage({ 'cmd': 'confirm' });
			worker.onmessage = function (e) {
				var end = window.performance.now();
				var time = end - start;
				document.getElementById('ts_webworker_creation').innerHTML='Creation took: ' + time + ' ms';
			};
		};
		
		function createWebworkerFromFile(){
			var start = window.performance.now();
			var worker = new Worker('roundtrip.js');
			worker.postMessage({ 'cmd': 'confirm' });
			worker.onmessage = function (e) {
				var end = window.performance.now();
				var time = end - start;
				document.getElementById('ts_webworker_creation_file').innerHTML='Creation took: ' + time + ' ms';
			};
		};
		
		
		function communication(){
			var start;
			var workerData = new Blob([document.getElementById('webworker_roundtrip').textContent], {
			    type: "text/javascript"
			});
			var worker = new Worker(window.URL.createObjectURL(workerData));
			worker.onmessage = function (e) {
				var end = window.performance.now();
				var time = end - start;
				document.getElementById('ts_webworker_comminication').innerHTML='Communication took: ' + time + ' ms';
			};
			start = window.performance.now();
			worker.postMessage({ 'cmd': 'confirm' });
		};
		
		function communciationFile(){
			var start;
			var worker = new Worker('roundtrip.js');
			worker.onmessage = function (e) {
				var end = window.performance.now();
				var time = end - start;
				document.getElementById('ts_webworker_comminication_file').innerHTML='Communication took: ' + time + ' ms';
			};
			start = window.performance.now();
			worker.postMessage({ 'cmd': 'confirm' });
		};
		
		
		var is_object = function(someVar){
			return (Object.prototype.toString.call( someVar ) === '[object Object]');
		};
	</script>
	
	
</head>
 
<body>
 	<div id="result"></div>
 	<a href="javascript:;" onclick="local();">direct</a>&nbsp;&nbsp;<span id="ts_normal"></span><br/>
 	<a href="javascript:;" onclick="runWebworker();">run in webworker</a>&nbsp;&nbsp;<span id="ts_webworker"></span><br/>
 	<a href="javascript:;" onclick="runWebworkerFromFile();">run in webworker (file)</a>&nbsp;&nbsp;<span id="ts_webworker_file"></span><br/>
 
 	<br/>
 	<a href="javascript:;" onclick="createWebworker();">measure webworker creation time (including commincation and confirmation)</a>&nbsp;&nbsp;<span id="ts_webworker_creation"></span><br/>
 	<a href="javascript:;" onclick="createWebworkerFromFile();">measure webworker (file) creation time (including commincation and confirmation)</a>&nbsp;&nbsp;<span id="ts_webworker_creation_file"></span><br/>
 	
 	<br/>
 	<a href="javascript:;" onclick="communication();">measure webworker communication time</a>&nbsp;&nbsp;<span id="ts_webworker_comminication"></span><br/>
 	<a href="javascript:;" onclick="communciationFile();">measure webworker (file) communication time</a>&nbsp;&nbsp;<span id="ts_webworker_comminication_file"></span><br/>	
 
 	
 	
</body>
 
</html>